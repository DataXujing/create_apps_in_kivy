<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="徐静">
  <link rel="shortcut icon" href="../icon.ico">
  
  <title>第三章 涂鸦画板项目基于kivymd实现 - Python Kivy创建Apps</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u7b2c\u4e09\u7ae0 \u6d82\u9e26\u753b\u677f\u9879\u76ee\u57fa\u4e8ekivymd\u5b9e\u73b0";
    var mkdocs_page_input_path = "chapter3.md";
    var mkdocs_page_url = "/chapter3/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../about/" class="icon icon-home"> Python Kivy创建Apps</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../about/">关于</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="..">前言</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../chapter1/">第一章 Kivy简介</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../chapter2/">第二章 涂鸦画板项目基于kivy实现</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">第三章 涂鸦画板项目基于kivymd实现</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#kivymd">第三章 涂鸦画板项目基于kivymd实现</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#1">1.项目展示与画板整体界面</a></li>
        
            <li><a class="toctree-l3" href="#2mdfloatingactionbuttonspeeddial">2.改变线宽MDFloatingActionButtonSpeedDial的实现</a></li>
        
            <li><a class="toctree-l3" href="#3mdfloatingactionbutton">3.清除功能MDFloatingActionButton的实现</a></li>
        
            <li><a class="toctree-l3" href="#4mdroundflatbutton">4.改变颜色MDRoundFlatButton的实现</a></li>
        
            <li><a class="toctree-l3" href="#5">5.项目总结</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../chapter4/">第四章 智能车道线检测项目(基于Kivy)</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../chapter5/">第五章 基于生成对抗网络(GAN)的一键现实转换二次元动画场景迁移项目(基于Kivymd)</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../chapter6/">第六章 pyinstaller打包Windows桌面应用程序</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../chapter7/">第七章 setupfactory安装程序打包</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../chapter8/">第八章 p4a Android打包基于kivy的涂鸦画板项目</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../chapter9/">第九章 buildozer Android打包基于kivymd的涂鸦画板项目</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../chapter10/">第十章 总结及项目展示</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../about/">Python Kivy创建Apps</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../about/">Docs</a> &raquo;</li>
    
      
    
    <li>第三章 涂鸦画板项目基于kivymd实现</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/DataXujing/create_apps_in_kivy/edit/master/docs/chapter3.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="kivymd">第三章 涂鸦画板项目基于kivymd实现</h2>
<hr />
<h3 id="1">1.项目展示与画板整体界面</h3>
<p>我们进一步对涂鸦画板在界面层面上做优化，我们使用kivymd库进行界面的优化，kivymd是与Material Desugn兼容的小部件的集合，可与kivy一起使用，kivymd的目标是在不牺牲易用性或应用程序性能的前提下，尽可能接近Google的Material Design规范。kivymd的原作者三年前停止更新项目，<a href="https://github.com/HeaTTheatR/KivyMD">https://github.com/HeaTTheatR/KivyMD</a>对kivymd进行进一步的开发，目前该项目仍然处于测试版的阶段。</p>
<p>首先我们使用kivymd构建界面，创建<code>main.py</code></p>
<pre><code class="python">
from kivy.lang import Builder
from kivy.graphics import Line, Color
from kivy.uix.widget import Widget
from kivy.uix.boxlayout import BoxLayout
from kivy.properties import StringProperty

from kivymd.app import MDApp
from kivymd.theming import ThemableBehavior



global line_width
line_width = 2

# 这个类主要copy我们在上一章中构建的类
class DrawCanvasWidget(Widget):
    def __init__(self,**kwargs):
        super().__init__(**kwargs)
        # 默认划线的颜色
        self.line_color = [0,0,0,1]
        self.canvas.add(Color(rgba=[0,0,0,1]))

    def on_touch_down(self,touch):

        if Widget.on_touch_down(self,touch):
            return
        with self.canvas:
            touch.ud['current_line'] = Line(points=(touch.x,touch.y),width=line_width)

    def on_touch_move(self,touch):
        if 'current_line' in touch.ud:
            touch.ud['current_line'].points += (touch.x,touch.y)



    def change_color(self,new_color):
        # global line_color
        self.line_color = new_color  # 在清除画板时使用
        self.canvas.add(Color(rgb=self.line_color))

    def change_line_width(self,line_width_ico=&quot;baby-face&quot;):
        global line_width
        line_width = {&quot;babel&quot;:1,&quot;baby-face&quot;:2,&quot;baguette&quot;:4}[line_width_ico]

    def clean_canvas(self):
        saved = self.children[:]  # 保留root控件上的子控件（button)
        self.clear_widgets()  # 清除所有控件间
        self.canvas.clear()   # 清除canvas
        for widget in saved:  # 将清除的子控件再画上
            self.add_widget(widget)

        self.change_color(self.line_color)


class PaintsApp(MDApp):

    def build(self):
        self.icon = &quot;./icon.ico&quot;
        self.title = &quot;涂鸦画板(kivymd版)&quot;
        self.theme_cls.primary_palette = &quot;Blue&quot; 

        return Builder.load_file(&quot;./paint.kv&quot;)


if __name__ == &quot;__main__&quot;:
    PaintsApp().run()

</code></pre>

<p>创建<code>paint.kv</code>的UI界面</p>
<pre><code># paint in kivymd by xu jing.
# date 2020-07-09

BoxLayout:
    orientation: 'vertical'

    # toolbar
    MDToolbar:
        title: 'Paint'
        elevation: 10
        left_action_items: [['menu', lambda x: None]]
        spacing: 10
        padding: 10

    # paint canvas
    DrawCanvasWidget:
        id: my_paint
        canvas.before:
            Color:
                rgba: [1,1,1,1]
            Rectangle:
                pos: self.pos
                size: self.size

</code></pre>

<div align=center>
<img src="../img/ch3/p1.png" /> 
</div>

<h3 id="2mdfloatingactionbuttonspeeddial">2.改变线宽MDFloatingActionButtonSpeedDial的实现</h3>
<p>通过kivymd中的MDFloatingActionButtonSpeedDial实现线宽的改变，修改<code>main.py</code></p>
<pre><code class="python">
from kivy.lang import Builder
from kivy.graphics import Line, Color
from kivy.uix.widget import Widget
from kivy.uix.boxlayout import BoxLayout
from kivy.properties import StringProperty

from kivymd.app import MDApp
from kivymd.theming import ThemableBehavior



global line_width
line_width = 2

# 这个类主要copy我们在上一章中构建的类
class DrawCanvasWidget(Widget):
    def __init__(self,**kwargs):
        super().__init__(**kwargs)
        # 默认划线的颜色
        self.line_color = [0,0,0,1]
        self.canvas.add(Color(rgba=[0,0,0,1]))

    def on_touch_down(self,touch):

        if Widget.on_touch_down(self,touch):
            return
        with self.canvas:
            touch.ud['current_line'] = Line(points=(touch.x,touch.y),width=line_width)

    def on_touch_move(self,touch):
        if 'current_line' in touch.ud:
            touch.ud['current_line'].points += (touch.x,touch.y)



    def change_color(self,new_color):
        # global line_color
        self.line_color = new_color  # 在清除画板时使用
        self.canvas.add(Color(rgb=self.line_color))

    def change_line_width(self,line_width_ico=&quot;baby-face&quot;):
        global line_width
        line_width = {&quot;babel&quot;:1,&quot;baby-face&quot;:2,&quot;baguette&quot;:4}[line_width_ico]

    def clean_canvas(self):
        saved = self.children[:]  # 保留root控件上的子控件（button)
        self.clear_widgets()  # 清除所有控件间
        self.canvas.clear()   # 清除canvas
        for widget in saved:  # 将清除的子控件再画上
            self.add_widget(widget)

        self.change_color(self.line_color)


class PaintsApp(MDApp):
    # 修改线宽的功能
    data = {
        &quot;babel&quot;: &quot;Thin&quot;,
        &quot;baby-face&quot;: &quot;Normal&quot;,
        &quot;baguette&quot;: &quot;Thick&quot;,
    }

    def callback(self, instance):
        # print(instance.icon)
        if instance.icon in [&quot;babel&quot;,&quot;baby-face&quot;,&quot;baguette&quot;]:
            DrawCanvasWidget().change_line_width(line_width_ico=instance.icon)
            # print(line_width)


    def build(self):
        self.icon = &quot;./icon.ico&quot;
        self.title = &quot;涂鸦画板(kivymd版)&quot;
        self.theme_cls.primary_palette = &quot;Blue&quot; 

        return Builder.load_file(&quot;./paint.kv&quot;)


if __name__ == &quot;__main__&quot;:
    PaintsApp().run()
</code></pre>

<p><code>paint.kv</code>增加修改线宽的功能</p>
<pre><code># paint in kivymd by xu jing.
# date 2020-07-09

BoxLayout:
    orientation: 'vertical'

    # toolbar
    MDToolbar:
        title: 'Paint'
        elevation: 10
        left_action_items: [['menu', lambda x: None]]
        spacing: 10
        padding: 10

    # paint canvas
    DrawCanvasWidget:
        id: my_paint
        canvas.before:
            Color:
                rgba: [1,1,1,1]
            Rectangle:
                pos: self.pos
                size: self.size


    # line width
    MDFloatingActionButtonSpeedDial:
        data: app.data
        hint_animation: True
        rotation_root_button: True
        callback: app.callback

</code></pre>

<div align=center>
<img src="../img/ch3/p2.png" /> 
</div>

<h3 id="3mdfloatingactionbutton">3.清除功能MDFloatingActionButton的实现</h3>
<p>增加清除canvas的功能，在界面设计时，我们已经在上一章中实现了清除的事件，仅仅在<code>paint.kv</code>中实现清除的控件即可</p>
<pre><code># paint in kivymd by xu jing.
# date 2020-07-09

BoxLayout:
    orientation: 'vertical'

    # toolbar
    MDToolbar:
        title: 'Paint'
        elevation: 10
        left_action_items: [['menu', lambda x: None]]
        spacing: 10
        padding: 10

        # clean canvas
        MDFloatingActionButton:
            icon: &quot;./icon.ico&quot;
            opposite_colors: True
            elevation_normal: 8
            md_bg_color: app.theme_cls.primary_color
            pos_hint: {&quot;center_x&quot;: .5,&quot;center_y&quot;: .5}
            on_release: root.ids.my_paint.clean_canvas()


    # paint canvas
    DrawCanvasWidget:
        id: my_paint
        canvas.before:
            Color:
                rgba: [1,1,1,1]
            Rectangle:
                pos: self.pos
                size: self.size

    # line width
    MDFloatingActionButtonSpeedDial:
        data: app.data
        hint_animation: True
        rotation_root_button: True
        callback: app.callback


</code></pre>

<div align=center>
<img src="../img/ch3/p3.png" /> 
</div>

<h3 id="4mdroundflatbutton">4.改变颜色MDRoundFlatButton的实现</h3>
<p>增加canvas线条颜色的功能，在界面设计时，我们已经在上一章中实现了更改颜色的事件，仅仅在<code>paint.kv</code>中实现更改颜色的控件即可</p>
<pre><code>
# paint in kivymd by xu jing.
# date 2020-07-09

BoxLayout:
    orientation: 'vertical'

    # toolbar
    MDToolbar:
        title: 'Paint'
        elevation: 10
        left_action_items: [['menu', lambda x: None]]
        spacing: 10
        padding: 10

        # line color
        MDRoundFlatButton:
            text: &quot;Red&quot;
            elevation_normal: 2
            opposite_colors: True
            md_bg_color: [1,0,0,1]
            pos_hint: {&quot;center_x&quot;: .5,&quot;center_y&quot;: .5}
            on_release: root.ids.my_paint.change_color(self.md_bg_color)

        MDRoundFlatButton:
            text: &quot;Green&quot;
            elevation_normal: 2
            opposite_colors: True
            md_bg_color: [0,1,0,1]
            pos_hint: {&quot;center_x&quot;: .5,&quot;center_y&quot;: .5}
            on_release: root.ids.my_paint.change_color(self.md_bg_color)

        MDRoundFlatButton:
            text: &quot;Blue&quot;
            elevation_normal: 2
            opposite_colors: True
            md_bg_color: [0,0,1,1]
            pos_hint: {&quot;center_x&quot;: .5,&quot;center_y&quot;: .5}
            on_release: root.ids.my_paint.change_color(self.md_bg_color)

        # clean canvas
        MDFloatingActionButton:
            icon: &quot;./icon.ico&quot;
            opposite_colors: True
            elevation_normal: 8
            md_bg_color: app.theme_cls.primary_color
            pos_hint: {&quot;center_x&quot;: .5,&quot;center_y&quot;: .5}
            on_release: root.ids.my_paint.clean_canvas()


    # paint canvas
    DrawCanvasWidget:
        id: my_paint
        canvas.before:
            Color:
                rgba: [1,1,1,1]
            Rectangle:
                pos: self.pos
                size: self.size

    # line width
    MDFloatingActionButtonSpeedDial:
        data: app.data
        hint_animation: True
        rotation_root_button: True
        callback: app.callback

</code></pre>

<div align=center>
<img src="../img/ch3/p4.png" /> 
</div>

<h3 id="5">5.项目总结</h3>
<p>我们使用kivymd优化了kivy的UI界面，使其看起来更像是一个安卓或ios的NUI应用，对于UI方面的设计笔者并不精通，在真正的项目开发过程中，可以寻求公司UI设计师的帮助，基于UI设计师对于控件的设计，我们使用kivy或kivymd去实现。</p>
<p><strong>TODO: p4a打包后在安卓模拟器上的使用效果</strong></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../chapter4/" class="btn btn-neutral float-right" title="第四章 智能车道线检测项目(基于Kivy)">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../chapter2/" class="btn btn-neutral" title="第二章 涂鸦画板项目基于kivy实现"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/DataXujing/create_apps_in_kivy/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../chapter2/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../chapter4/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
